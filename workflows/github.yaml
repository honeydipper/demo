---
workflows:
  # require .wfdata.prefix
  git_PR_contains:
    content: pipe
    data:
      on_error: exit
      "*steps":
        - name: getting changed files
          work:
            type: function
            content:
              target:
                system: github
                function: api
              parameters:
                URL: 'https://api.github.com/repos/{{ .event.json.repository.full_name }}/pulls/{{ .event.json.number }}/files'
                method: GET
        - name: scan for terraform files
          work:
            type: data
            content: 
              work_status: >-
                {{ `
                {{- $found := false }}
                {{- $wfdata := .wfdata }}
                {{- range .data.json }}
                {{- if (not $found) }}
                {{- if (index . "filename" | hasPrefix $wfdata.prefix) }}success
                {{- $found = true }}
                {{- end }}
                {{- end }}
                {{- end }}
                {{- if (not $found) }}failure
                {{- end }}`
                }}
              reason: Files under `{{ .wfdata.prefix }}` not changed
